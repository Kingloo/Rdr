<Window x:Class="Rdr.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:this="clr-namespace:Rdr"
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        Title="Rdr"
        WindowState="Maximized"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        MinWidth="1500" MinHeight="1000">

    <Window.Resources>

        <DataTemplate DataType="{x:Type this:Feed}">
            <Label Content="{Binding Path=Title}">
                <Label.InputBindings>
                    <MouseBinding MouseAction="LeftDoubleClick"
                                              Command="{Binding Path=RefreshFeedAsyncCommand, ElementName=feedManager}"
                                              CommandParameter="{Binding}" />
                    <MouseBinding MouseAction="MiddleClick"
                                              Command="{Binding Path=MoveItemsToViewCommand, ElementName=feedManager}"
                                              CommandParameter="{Binding}" />
                    <MouseBinding MouseAction="RightDoubleClick"
                                              Command="{Binding Path=GoToFeedCommand, ElementName=feedManager}"
                                              CommandParameter="{Binding}" />

                </Label.InputBindings>
                <Label.ToolTip>
                    <TextBlock Text="{Binding Path=ItemsCount}" />
                </Label.ToolTip>
            </Label>
        </DataTemplate>

        <DataTemplate DataType="{x:Type this:FeedItem}">
            <this:ItemUC MinHeight="75">
                <this:ItemUC.InputBindings>
                    <MouseBinding MouseAction="LeftDoubleClick"
                                  Command="{Binding Path=GoToItemCommand, ElementName=feedManager}"
                                  CommandParameter="{Binding}" />
                    <MouseBinding MouseAction="RightDoubleClick"
                                  Command="{Binding Path=DebugCommand, ElementName=feedManager}"
                                  CommandParameter="{Binding}" />
                </this:ItemUC.InputBindings>
            </this:ItemUC>
        </DataTemplate>

        <CollectionViewSource Source="{Binding Path=Feeds}"
                              x:Key="sortFeedsAlphabetically"
                              IsLiveSortingRequested="True">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="Title" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        
        <CollectionViewSource Source="{Binding Path=Items}"
                              x:Key="sortItemsByPubDate"
                              IsLiveSortingRequested="True">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="Published" Direction="Descending" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        
    </Window.Resources>

    <Window.DataContext>
        <this:FeedManager x:Name="feedManager" />
    </Window.DataContext>

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding Path=RefreshAllFeedsAsyncCommand}" />
        <KeyBinding Key="F9" Command="{Binding Path=MoveUnreadItemsToViewCommand}" />
        <KeyBinding Key="F12" Command="{Binding Path=MarkAllItemsAsReadCommand}"  />
        <KeyBinding Key="F11" Command="{Binding Path=DebugCommand}" />
    </Window.InputBindings>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="100" />
            <RowDefinition Height="*" />
            <RowDefinition Height="70" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Stretch"
                    Orientation="Horizontal">
            
            <Button Content="Refresh All Feeds"
                    ToolTip="F5"
                    Command="{Binding Path=RefreshAllFeedsAsyncCommand}"
                    Margin="25,0,0,0" />
            
            <Button Content="Restore Unread Items"
                    ToolTip="F9"
                    Command="{Binding Path=MoveUnreadItemsToViewCommand}"
                    Margin="25,0,0,0" />
            
            <Button Content="Mark All As Read"
                    ToolTip="F12"
                    Command="{Binding Path=MarkAllItemsAsReadCommand}"
                    Margin="25,0,0,0" />
            
        </StackPanel>

        <Label x:Name="Status"
               Grid.Row="2"
               Content="{Binding Path=Status}" />

        <Grid Grid.Row="1">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="150" MaxWidth="350" />
                <ColumnDefinition Width="*" MinWidth="500" />
            </Grid.ColumnDefinitions>

            <ItemsControl Grid.Column="0"
                          ItemsSource="{Binding Source={StaticResource sortFeedsAlphabetically}}">

                <ItemsControl.Template>
                    <ControlTemplate>
                        <ScrollViewer CanContentScroll="True">
                            <ItemsPresenter />
                        </ScrollViewer>
                    </ControlTemplate>
                </ItemsControl.Template>

                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

            </ItemsControl>

            <ItemsControl Grid.Column="1" 
                         ItemsSource="{Binding Source={StaticResource sortItemsByPubDate}}">

                <ItemsControl.Template>
                    <ControlTemplate>
                        <ScrollViewer CanContentScroll="False" >
                            <ItemsPresenter />
                        </ScrollViewer>
                    </ControlTemplate>
                </ItemsControl.Template>
                
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

            </ItemsControl>
        </Grid>
    </Grid>
</Window>
